Forest windows machine from HTB

Starting with the typical nmap port scanning:

<img width="796" alt="1" src="https://user-images.githubusercontent.com/47299364/70398759-f9c50080-1a1e-11ea-92be-15633971565d.png">

<img width="1206" alt="2" src="https://user-images.githubusercontent.com/47299364/70398762-00537800-1a1f-11ea-9d00-ec683e2e34a2.png">

The port scanning shows a bunch of ports opened. Ldap, SMB, etc.

Let's try to enumerate some users using rpcclient:

<img width="512" alt="3" src="https://user-images.githubusercontent.com/47299364/70398775-2bd66280-1a1f-11ea-8152-9eb0b3c2d262.png">

<img width="1384" alt="4" src="https://user-images.githubusercontent.com/47299364/70398777-38f35180-1a1f-11ea-90a9-b713be11fe2e.png">

Some interesting users, after several attempts the only interesting one was svc-alfresco that gave us a TGT ticket.

<img width="1403" alt="5" src="https://user-images.githubusercontent.com/47299364/70398786-4f99a880-1a1f-11ea-872b-cacc121bb9f2.png">

Let's crack it using john, and the password for svc-alfresco is s3rvice:

<img width="883" alt="6" src="https://user-images.githubusercontent.com/47299364/70398837-722bc180-1a1f-11ea-8832-d3e1b86d8722.png">

With that we can use evil-winrm to authenticate to the machine using this account:

<img width="431" alt="7" src="https://user-images.githubusercontent.com/47299364/70398850-9edfd900-1a1f-11ea-9fbb-10e52c082374.png">

<img width="517" alt="8" src="https://user-images.githubusercontent.com/47299364/70398853-b323d600-1a1f-11ea-874e-637a427e9df7.png">

We have now the user flag:

<img width="588" alt="9" src="https://user-images.githubusercontent.com/47299364/70398857-bae37a80-1a1f-11ea-874a-1a58f420385b.png">

After understanding that this is an Active directory, let's use a tool called Bloodhound that will getting information from the AD about what is the best past for domain admin. For that we had to run SharpHound.ps1 in the server that will generate some .json files that later will be used by Bloodhound tool to identify the best path's for DA.

<img width="1395" alt="10" src="https://user-images.githubusercontent.com/47299364/70398871-e49ca180-1a1f-11ea-8ce2-1d5663ae2d43.png">

The BloodHound graph after importing the zip file generated by SharpHound:
<img width="1341" alt="11" src="https://user-images.githubusercontent.com/47299364/70398887-039b3380-1a20-11ea-97a9-8745cc99ce9e.png">

We now understand that we need to find a way to get a user or svc-alfresco inside the "Exchange Windows Permissions" group because this has permissions to escalate to the domain admin group:

We can do that using the below net command:

<img width="1404" alt="12" src="https://user-images.githubusercontent.com/47299364/70398919-3c3b0d00-1a20-11ea-969c-4d989242d789.png">

Then there are several tools from the impacket project that will help us escalating privileges for the svc-alfresco account:

The first one to use is ntlmrelayx to get DCSync privileges for the svc-alfresco user:

<img width="888" alt="13" src="https://user-images.githubusercontent.com/47299364/70398948-71475f80-1a20-11ea-8dee-1a3ca1771f7b.png">

To accomplish the above there's also a need to access our localhost and provide the credentials for the user, then the request will be relayed for the domain controller.

After that, the tool will tell us that we can ran another tool from the impacket tool suite, secretsdump.py that will perform hash dump from the users:

